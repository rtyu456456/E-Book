<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fp.eb.mapper.TradeMapper">

	<select id="getAlltradelist"
		resultType="com.fp.eb.model.TradeDTO">
		select * from eb_trade
	</select>

	<select id="getTradelistMe"
		resultType="com.fp.eb.model.TradeDTO">
		select * from eb_trade where t_owner = #{u_id }
		<!-- 나중에 유저 닉네임과 연동할 것 -->
	</select>

	<select id="getTradeDetail"
		resultType="com.fp.eb.model.TradeDTO">
		select * from eb_trade where t_no = #{t_no }
	</select>
	
	<select id="getUserInfo" resultType="com.fp.eb.model.TradeTotalDTO">
		select * from eb_user where t_onwer = #{u_id } and t_no = #{t_no }
	</select>
	
	

	<select id="getTradeList" resultType="com.fp.eb.model.TradeDTO">
		SELECT * FROM eb_trade
		WHERE t_book_title LIKE '%'||#{t_book_title}||'%'
	</select>


	<insert id="regTradeBook">
		insert into eb_trade values(
		eb_trade_seq.nextval,
		#{t_owner },
		#{t_title },
		#{t_book_title },
		#{t_authors },
		#{t_publisher },
		#{t_contents },
		#{t_price },
		#{t_thumbnail },
		#{t_map_lat},
		#{t_map_lng	},
		#{t_marker_lat },
		#{t_marker_lng },
		0,
		sysdate)
	</insert>
	
	
	
	
	


	<select id="getToMsg" resultType="com.fp.eb.model.TradeTotalDTO">
		select * from eb_trade_msg emsg, eb_user eu
		where emsg.m_to = eu.u_id and
		emsg.m_to = #{u_id}
	</select>

	<select id="getFromMsg"
		resultType="com.fp.eb.model.TradeTotalDTO">
		select * from eb_trade_msg emsg, eb_user eu
		where emsg.m_from = eu.u_id and
		emsg.m_from = #{u_id}
	</select>


	<select id="chooseTradeMsg"
		resultType="com.fp.eb.model.TradeTotalDTO">
		select * from eb_trade, eb_trade_msg where t_no =m_trade
		and (m_to = #{u_id } or m_from = #{u_id })
	</select>

	<insert id="sendMsg" parameterType="com.fp.eb.model.MsgDTO">
		insert into eb_trade_msg
		values(eb_trade_msg_seq.nextval,#{m_trade },#{m_to },#{m_from
		},#{m_txt },sysdate,#{m_check })
	</insert>

	<delete id="deleteMsg" parameterType="com.fp.eb.model.TradeTotalDTO">
	delete from eb_trade_msg where m_no = #{m_no }
	</delete>




</mapper>